<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨ºæ–·é é¢</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .status { 
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 8px;
            background: #2a2a2a;
        }
        .ok { border-left: 4px solid #10b981; }
        .error { border-left: 4px solid #ef4444; }
        pre { 
            background: #111; 
            padding: 15px; 
            border-radius: 4px; 
            overflow-x: auto;
        }
        h1 { color: #8b5cf6; }
        h2 { color: #22d3ee; margin-top: 30px; }
        button {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #7c3aed; }
    </style>
</head>
<body>
    <h1>ğŸ” ModernReader è¨ºæ–·é é¢</h1>
    
    <div class="status ok">
        <h3>âœ… HTML å·²è¼‰å…¥</h3>
        <p>é€™å€‹æª”æ¡ˆèƒ½æ­£å¸¸é¡¯ç¤ºï¼Œè¡¨ç¤º HTTP ä¼ºæœå™¨é‹ä½œæ­£å¸¸ã€‚</p>
    </div>

    <h2>React è¼‰å…¥æ¸¬è©¦</h2>
    <div id="react-test"></div>

    <h2>Console è¼¸å‡º</h2>
    <div id="console-output"></div>

    <h2>å¿«é€Ÿæ“ä½œ</h2>
    <button onclick="location.href='https://localhost:3000'">è¿”å›ä¸»æ‡‰ç”¨</button>
    <button onclick="location.reload()">é‡æ–°è¼‰å…¥</button>
    <button onclick="clearStorage()">æ¸…é™¤ LocalStorage</button>

    <h2>ç’°å¢ƒè³‡è¨Š</h2>
    <div class="status ok">
        <pre id="env-info"></pre>
    </div>

    <script type="module">
        // æ•ç²æ‰€æœ‰ console è¨Šæ¯
        const consoleDiv = document.getElementById('console-output');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addConsoleMessage(type, args) {
            const div = document.createElement('div');
            div.className = `status ${type === 'error' ? 'error' : 'ok'}`;
            div.innerHTML = `<strong>[${type.toUpperCase()}]</strong> ${args.join(' ')}`;
            consoleDiv.appendChild(div);
        }

        console.log = (...args) => {
            originalLog.apply(console, args);
            addConsoleMessage('log', args);
        };
        console.error = (...args) => {
            originalError.apply(console, args);
            addConsoleMessage('error', args);
        };
        console.warn = (...args) => {
            originalWarn.apply(console, args);
            addConsoleMessage('warn', args);
        };

        // ç’°å¢ƒè³‡è¨Š
        document.getElementById('env-info').textContent = JSON.stringify({
            userAgent: navigator.userAgent,
            screen: {
                width: screen.width,
                height: screen.height
            },
            localStorage: {
                THEME_MODE: localStorage.getItem('THEME_MODE'),
                SHOW_STATUS: localStorage.getItem('SHOW_STATUS'),
                keys: Object.keys(localStorage)
            }
        }, null, 2);

        // æ¸¬è©¦ React
        try {
            console.log('ğŸ“¦ é–‹å§‹è¼‰å…¥ React...');
            import('react').then(React => {
                console.log('âœ… React è¼‰å…¥æˆåŠŸ:', React.version);
                import('react-dom/client').then(ReactDOM => {
                    console.log('âœ… ReactDOM è¼‰å…¥æˆåŠŸ');
                    import('./App.tsx').then(({ default: App }) => {
                        console.log('âœ… App çµ„ä»¶è¼‰å…¥æˆåŠŸ');
                        const container = document.getElementById('react-test');
                        const root = ReactDOM.createRoot(container);
                        root.render(React.createElement('div', { 
                            style: { padding: '20px', background: '#10b981', borderRadius: '8px', color: 'white' }
                        }, 'âœ… React æ¸²æŸ“æˆåŠŸï¼App çµ„ä»¶å¯ä»¥æ­£å¸¸è¼‰å…¥ã€‚'));
                    }).catch(err => {
                        console.error('âŒ App çµ„ä»¶è¼‰å…¥å¤±æ•—:', err.message);
                        console.error(err.stack);
                    });
                }).catch(err => {
                    console.error('âŒ ReactDOM è¼‰å…¥å¤±æ•—:', err.message);
                });
            }).catch(err => {
                console.error('âŒ React è¼‰å…¥å¤±æ•—:', err.message);
            });
        } catch (err) {
            console.error('âŒ æ•´é«”è¼‰å…¥å¤±æ•—:', err.message);
            console.error(err.stack);
        }

        function clearStorage() {
            localStorage.clear();
            sessionStorage.clear();
            alert('å·²æ¸…é™¤æ‰€æœ‰å„²å­˜è³‡æ–™');
            location.reload();
        }
        window.clearStorage = clearStorage;

        // å…¨å±€éŒ¯èª¤è™•ç†
        window.onerror = function(message, source, lineno, colno, error) {
            console.error(`å…¨å±€éŒ¯èª¤: ${message} at ${source}:${lineno}:${colno}`);
            if (error) console.error(error.stack);
            return false;
        };

        window.onunhandledrejection = function(event) {
            console.error('æœªè™•ç†çš„ Promise æ‹’çµ•:', event.reason);
        };
    </script>
</body>
</html>
