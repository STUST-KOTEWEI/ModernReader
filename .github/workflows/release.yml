name: Create Release

on:
  push:
    tags:
      - 'v*.*.*'  # Triggers on version tags like v1.0.0, v2.1.3, etc.

permissions:
  contents: write

jobs:
  release:
    name: Create Release
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for proper release notes
      
      - name: Get version from tag
        id: get_version
        run: |
          VERSION=${GITHUB_REF#refs/tags/}
          echo "version=${VERSION}" >> $GITHUB_OUTPUT
          echo "version_number=${VERSION#v}" >> $GITHUB_OUTPUT
      
      - name: Create release archive
        run: |
          mkdir -p release
          zip -r release/ModernReader-${{ steps.get_version.outputs.version }}.zip \
            index.html \
            styles.css \
            app.js \
            README.md \
            CHANGELOG.md \
            CONTRIBUTING.md \
            VERSION \
            -x "*.git*"
      
      - name: Generate release notes
        id: release_notes
        run: |
          cat > release_notes.md << 'EOF'
          ## ðŸš€ ModernReader Royale ${{ steps.get_version.outputs.version }}
          
          ### ðŸ“¦ ä¸‹è¼‰
          - ä¸‹è¼‰ `ModernReader-${{ steps.get_version.outputs.version }}.zip` è§£å£“å³å¯ä½¿ç”¨
          - æˆ–è¨ªå• GitHub Pages: [https://stust-kotewei.github.io/ModernReader/](https://stust-kotewei.github.io/ModernReader/)
          
          ### ðŸ“ æ›´æ–°å…§å®¹
          æ­¤ç‰ˆæœ¬åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š
          - `index.html` - ä¸»é é¢
          - `styles.css` - æ¨£å¼è¡¨
          - `app.js` - JavaScript åŠŸèƒ½
          - `README.md` - å°ˆæ¡ˆèªªæ˜Ž
          
          ### ðŸŽ¯ ä½¿ç”¨æ–¹å¼
          1. ä¸‹è¼‰ä¸¦è§£å£“ ZIP æ–‡ä»¶
          2. ä½¿ç”¨ä»»æ„éœæ…‹ä¼ºæœå™¨é–‹å•Ÿ (ä¾‹å¦‚: `npx serve .` æˆ– `python -m http.server`)
          3. åœ¨ç€è¦½å™¨ä¸­æ‰“é–‹ `index.html`
          
          ### ðŸŒŸ åŠŸèƒ½äº®é»ž
          - æ——è‰¦å¼ Hero å€å¡Š
          - Signature Experiences
          - Immersive Atelier é¢æ¿
          - ç­–å±•æ˜Ÿåœ–
          - ç¦®è³“æœå‹™æ¨¡çµ„
          
          ---
          
          **æŸ¥çœ‹å®Œæ•´è®Šæ›´:** https://github.com/${{ github.repository }}/releases/tag/${{ steps.get_version.outputs.version }}
          EOF
          
          echo "notes_file=release_notes.md" >> $GITHUB_OUTPUT
      
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          name: ModernReader Royale ${{ steps.get_version.outputs.version }}
          body_path: release_notes.md
          files: |
            release/ModernReader-${{ steps.get_version.outputs.version }}.zip
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ModernReader-${{ steps.get_version.outputs.version }}
          path: release/ModernReader-${{ steps.get_version.outputs.version }}.zip
          retention-days: 90
