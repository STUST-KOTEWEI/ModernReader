<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ModernReader</title>
  <!-- Styles are loaded via main.tsx import to support Vite build hashing -->
  </head>
  <body>
    <script>
      (function(){
        try {
          var params = new URLSearchParams(location.search);
          if (location.protocol === 'file:' || params.has('demo')) {
            localStorage.setItem('mr_demo', '1');
            localStorage.setItem('mr_demo_forced', '1');
          }
          // Auto fallback: if not explicitly in demo AND user didn't request online mode, 
          // quickly probe backend health. If unreachable or non-200 within ~1.2s, enable demo to avoid 500s on auth.
          var userWantsOnline = localStorage.getItem('mr_online_requested') === '1';
          if (localStorage.getItem('mr_demo') !== '1' && !userWantsOnline) {
            var ctrl = new AbortController();
            var timer = setTimeout(function(){ ctrl.abort(); }, 1200);
            fetch('/api/v1/health', { cache: 'no-store', signal: ctrl.signal })
              .then(function(res){ if (!res.ok) throw new Error('bad'); })
              .catch(function(){ try { localStorage.setItem('mr_demo', '1'); } catch(e) {} })
              .finally(function(){ clearTimeout(timer); });
          }
          // Clear the online request flag after check (one-time use)
          if (userWantsOnline) {
            try { localStorage.removeItem('mr_online_requested'); } catch(e) {}
          }
        } catch (e) {}
      })();
    </script>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
